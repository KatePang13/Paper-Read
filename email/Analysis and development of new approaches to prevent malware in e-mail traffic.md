#  Analysis and development of new approachesto prevent malware in Email traffic

origin:   https://github.com/sbidy/MacroMilter/blob/master/Bachelorarbeit%20-%20Traub%2C%20Stephan.pdf

**Page 1**

**Stuttgart Media University**

to obtain the academic degree of a Bachelor of Science   on *07/17/2016*

First supervisor: **Prof. Dr. Martin Goik**   *University of the Media*

Second supervisor: **Dipl.-Ing. Benjamin Kenner**   *audius GmbH*



# Statutory declaration

I, Stephan Traub, hereby declare on my honor that I have read the present Ba-

chelation work with the title: Analysis and elaboration of new approaches to prevent

malware in e-mail traffic independently and without outside help

and did not use any aids other than those specified. The bodies

the work, the wording or meaning of which was taken from other works

den, are indicated in each case with indication of the source. the work is

not yet published or presented in another form as an examination performance.

I have understood the importance of the honorary insurance and the legal

consequences (Ÿ 26 para. 2 Bachelor-SPO (6 semesters), Ÿ 24 para. 2 Bachelor-SPO

(7 semesters), Ÿ 23 para. 2 Master-SPO (3 semesters) or Ÿ 19 para. 2 Master-SPO

(4 semesters and part-time) of the HdM) an incorrect or incomplete

honorary insurance noted

StephanTraub Datum

## Abstract

Over 90 percent of assaults on computer users issue from a simple email. Ourstrong addiction to this communication system, in business environment as well as in private shpere, provides a huge surface for malware attacks. Current anti-malware filters can't provide a satisfactory to detection rate of these malware. This paper describes new possibilities for a dynamic recognition of the growing threat in the email traffic. Owing to these new approaches, they significantly increase the detection rates of the email filters of new forms of malware. The enhancement for this new approaches of both efficiency and the improved detection is currently outlined against filter technologies by measurements. This work focuses on prevailing existing threats relating to small to midsize email infrastructures.

```
Kurzfassung
```
## short version

Over 90% of attacks on computer users can be traced back to email become. Due to the strong dependence on this means of communication, both In the business as well as in the private environment, this offers an effective gateway for Malware. In many cases, current anti-malware filters cannot provide the best detection rate for this malware. This work shows new Opportunities for dynamic detection of the constantly growing threat in E-mail traffic on. With these new approaches, the detection rates of the E-Mail filter increased significantly, thus preventing new forms of malware. The increase in efficiency and the improved detection are compared to currently compared filter technologies by means of measurements. The focus here is on current all existing threats to small to medium-sized email infrastructures.



# 1.  Overview

Since the invention of e-mail, the number of e-mail addresses has been growing every day sent messages steadily. It's not uncommon these days for a single person has multiple email addresses. Almost taken for granted usually two each for business and private communication. This popularity and just as widespread use makes it the focus for mis-common use. Malware is often sent as an attachment or link camouflaged to an email in order to distribute it to as many users as possible. len. Because of the high number of messages that each user receives every day automated filtering is essential. These filters must evaluate automatically which of these messages the user wants to receive and which not. To the To find this fine tuning, different filter methods such as spam or anti-malware filters are used. Despite the use of such a filter comes it still leads to infections with malware disguised as an e-mail attachment would have.

### 1.1 Objective

This work is intended to show which deficits in terms of the prevention ofMalware exists within e-mail infrastructures with up to 1000 users.The two filter methods of the widespread e-mail Filter [Spamassassin](https://spamassassin.apache.org) and [Amavisd-New](https://www.ijs.si/software/amavisd/) and the [Postfix email server](http://www.postfix.org/) considertet. By working out new approaches, the recognition rate of the filters should be significantlySharply increased and so new forms of malware within e-mail trafficbe prevented. The focus will be on spam detection and analysislaid by attachments.A direct comparison of measurements should be used on a productive systemthe efficiency of the approaches can be demonstrated.1.2 structureFirst of all, a basis for understanding should be created andbe averaged. In the next step, the existing attack vectors of the E-Mail that are considered relevant to this work. Additionally willin Chapter 3 a standard for a measurement method is defined that is used for determiningthe initial situation is used. By analyzing and processing theMeasurement results can be used to identify and evaluate existing deficits. With Hil-fe these results should be achieved by optimizing and applying new approaches inChapter 4 improvement in the detection rate of spam and malware in theE-mail traffic can be achieved.1.3 Style of work Many of the sources listed are in English. Based onthe establishment of English terms in IT was not used in the work translated. Often, a translation would not help to understand the text.tes contribute. Corresponding explanations are available for topic-specific terms inFind glossary. Company, product and software names are shown in italics.made easy. In addition, when software is named, a footnote is also includedon the corresponding website. Program codes, configuration parametersor file paths are marked in mono-type.  

## 2 Introduction

Basically, terms that play a central role in thisWork to be described. Only in this way can a thorough understanding of theTopics are conveyed. In addition, the existing attack vectorsshown within an email traffic. There are several for this in this chapterReal and used types of attack are shown via email.2.1 De nitionsMalicious software: These are programs that are usually linked to a criticalwrapped in light background. Within the work the focus will be onthe malware that is distributed via email.In the context of the work, the English acronym Malware (malicious software)used as a synonym for malware. Malicious software and malware are the samesignificant to consider.Spam: A precise definition of spam is difficult to capture. GeneralizedSpam is referred to as unwanted and unwanted email. Mostly it ismessages that the user does not expect or does not understand.bond can be made with one process [7, [p](https://translate.googleusercontent.com/translate_f#62) . 8th]. An example would be hereAdvertise an online shop where the user has never made a purchase.Spam can also have a pornographic or criminal backgroundto have.Within the thesis, the spread of malware through emails is seeks. In this context, spam is defined as the means of transport for malware. Consequently there is a concatenation between spam prevention and malware prevention. Becomes a message is already recognized as spam due to its properties, is a class It is no longer necessary to identify the attachment using a malware scanner。

​				【Figure 1】

Figure 1: Subset diagram of spam. Source: author

As can be seen in Figure [1](https://translate.googleusercontent.com/translate_f#13) , spam detection leads to avoidance of malware as malware is a subset of spam messages.

This encapsulation of the contents creates a kind of chain with the following steps

1. If the e-mail is recognized as spam based on the connection information, a more detailed analysis of the attachment or e-mail text is no longer necessary.

2. However, if the message is not recognized in the first step, an analysis must be carried out of the text to be carried out on spam patterns.

3. If none of the previous steps provide a classification, the appendix must be explicitly checked for behavior and content patterns of malware.

### 2.2 Email

In 2015, emails sent in one day totaled 205.6 billion

den, with 112.5 billion received and sent in the work environment [ [43,](https://translate.googleusercontent.com/translate_f#66)

P. 4]. The communication based on the Simple Mail Transfer Protocol (SMTP)

tion medium is sometimes one of the most widely used transmission media

of news.

This makes e-mail a central component of daily communication

represents, the processing infrastructures with a high number of E-

Confronted mail objects. Here the challenge arises, the legitimate ham-

Distinguish email from unwanted spam. The goal must be the number

Spam messages that were incorrectly identified as ham (false positive), see above

to be kept as low as possible. On the other hand, the false negative rate must not

climb. This rate represents the number of emails that were spam or malware

but were still delivered to the user. Here these

are not recognized as such by the filter instances.

In principle, a higher false negative rate is accepted. The user

zer receives the spam e-mail in its mailbox, but can then if necessary

Clear. But if the false positive rate is too high, the user gets le-

gitime emails no longer. With the amount of messages received daily,

A slight increase in the two rates could already have thousands of e-mails

affect.

Referring to this work that every spam message also contains malware

can hold, the installments must be broken down further. Will be higher

If the false negative rate is used in malware filtering, there is a higher probability

likelihood that the user will receive malware within the email. In a loading

Trying to prevent malware would result in a higher false positive rate

have a better effect by rejecting messages more strictly

the risk potential of every e-mail decreases.

The e-mail itself contains the sender, recipient and the e-mail text

also other meta information important for the filtering. All information is

stored within the message's MIME tree. The RFC 2822 determines

the form in which this information must be given [37 [,](https://translate.googleusercontent.com/translate_f#65) p. 5ff]

One possibility to expand this tree with your own nodes to provide further informationIt is possible to store information via the e-mail. These accounts arehalf of a message is referred to as the MIME header or e-mail header. In case ofE-mail filters will gladly extend the e-mail headers for theused to specify the classification of an email. Thus, for example, a spam emailbe classified as such via an entry in the MIME tree. All lateOther filter instances and user applications can read out these values andpossibly to set new ones.

Listing 2.1: E-mail header of a legitimate e-mail with meta information.

```
Received: from <remote>Received: by <remote>
X-Spam-Flag: NO
X-Spam-Status: No, score = - 0.5 required = 5.0
X-Spam-Checker - Version: SpamAssassin 3.4.0 (2014 - 02 - 07) on <removed>
X-Spam-T ests: BAYES_00 = - 1.9, DKIM_SIGNED = 0th 1, DKIM_VALID = - 0.1, DKIM_VALID_AU = - 0.1,RCVD_IN_MSPIKE_H3 = - 1.5, RCVD_IN_MSPIKE_WL = - 0.01
X-Spam-RBL: <dns: 49.210.146.62.wl.mailspike.net> [127.0.0.18]
X-Spam-Timing: total 388 ms - read_scoreonly_config: 0.97 (0.3%),signal_user_changed: 1.77 (0.5%), parse: 0.72 (0.2%),extract_message_metadata: 13 (3.4%), get_uri_detail_list: 4.9 (1.3%)
X-Spam-RemoteHelo: <remote>
X-Spam-RelaysUntrusted: <removed>
X-Virus-Scanned: <removed>
Received: <remote>
From: <removed>
To: <remote>
Subject: <remote>
Date: <remote>
Message-ID: <remote>
References: <remote>
In-Reply-To: <remote>
Accept-Language: en-GB, de-DE, en-US
Content-Language: en - US
Content-Type: text / plain; charset = "iso - 8859 - 1"
Content-Transfer-Encoding: quoted - printable
MIME-Version: 1.0
Return-Path: <remote>
```

### 2.3 Attack vector email

In 91% of all attacks, email is the first point of contact with the victim [ [21,](https://translate.googleusercontent.com/translate_f#64) p.

3]. 30% of all recipients read emails with malware attached or one

Link to this. Of these, 12% open the attached or linked malware

Programs and execute them [49 [,](https://translate.googleusercontent.com/translate_f#66) p. 18].

As described, links are also often used for the spread of malware.

uses. Here, too, the user is tempted to click on this to on

to be directed to a website with integrated malware download [35 [,](https://translate.googleusercontent.com/translate_f#65) p. 5f].

In the worst case, the malware is caused by an existing security hole in the

Browser installed on the system. The user is not aware of this. Around

a higher chance of getting a successful infection

often links and followers combined in one spam e-mail.

The telecommunications company Verizon determined in an analysis in 2015

notes that email is one of the most common modes of transport to get around

To transmit malware to the user [49, [p](https://translate.googleusercontent.com/translate_f#66) . 46]. As a result, the e-mail

ne is the most important distribution channels for malicious code. This underlines again

the importance of filtering methods within the e-mail infrastructures to avoid such

Stop attacks.

This trend has been observed for some time. Reasons for the

number of attacks via e-mail are that vulnerabilities have entered a computer

are no longer so easy to exploit. With faster update cycles

for security patches and stronger encryption within network pro-

tokollen, the focus is more and more on the human being, misused as a weak point

to become [ [15,](https://translate.googleusercontent.com/translate_f#63) p. 2]. The possibilities of including malware in attachments and links-

ren, the email offers an interesting platform for dissemination. By tricky

Formulating and formatting a message, the user can in addition to a

unwanted action, the execution of the malware, are pushed.

The e-mail not only distributes malicious code, but also tries to get the

User to tap confidential data. These are mostly supplies

output data for online stores, e-mail mailboxes or as shown in Figure [2](https://translate.googleusercontent.com/translate_f#17) shown to

a bank. The user enters his login data on the fake website

and tries to log in like this, the attacker receives all entered data such as Passwords or usernames. This sub-form of spam is called phishing

but not examined further within this work, since this does not mean malware

is spread.

Another point is that there is no security of integrity whatsoever within an email

gives. This means that a recipient can at no time be sure that the other

The sender shown is also the one who sent the email [33 [,](https://translate.googleusercontent.com/translate_f#65) p. 9f]. In this

In this case, only the recipient can evaluate whether he has received the content of the email with the

Can connect senders. A server-side evaluation of the sender

is only around half of the Alexa Top Million Domains[1](https://translate.googleusercontent.com/translate_f#17) carried out [[ 12,](https://translate.googleusercontent.com/translate_f#63) p.

1]. In the case of small systems in the medium-sized or private sector, the

Number to be assessed even lower.

Basically, the e-mail forms due to the lack of security of integrity and the wide

Spread a very large area of attack. The flexibility and the far-reaching

Features of the content of an email make it hard for filter systems to spam

and distinguish malware from legitimate messages




### 2.4 Example of an attack sequence

In many cases, the attack begins with a supposedly legitimate email
Recipient.Common topics such as billing o the
used as an excuse. This content is not just for each recipient
from the very outset, they also convey a certain risk.
nowadays, a gitalized process is a paperless invoicing
perfectly common.

``
Figure 3: Spam email with malware attached. Source: Author
``
Figure 3 shows such an email with a malware attachment.
Users should not be able to see that they are in the appendix
This attachment is often used by MicrosoftOf-
 ce document represents. It represents a familiar to most users
The file type is often used here in Microsoft Word of Microsoft Excel documents
used [34, p.19].


In order to increase confidentiality, the sender of the e-mail
falsified by the malware sender, so it is not possible to view the sender
Conclusions about the authenticity of the messages. Even for experienced users
It is almost impossible for the user to determine whether it is really a fake
For example, the query of the domain owner also shows this case
no suspicious result, as can be seen in Figure 4. The owner is here
really a legit company.

``
Figure 4: Domain query eimDomain-Registrar. Source: Author
``
The purely textual content of the e-mail is therefore not
In the case of the attachment so the link, the harmfulness will only be more precise afterwards
Analysis visible.

In the best case scenario, the file will be saved on the user's computer
already recognized by the local virus scanner. Thanks to these quick modifications
of the malware by the developers and which mostly only act once a day
Up-to-date malware scanner, the scanner may not be recognized
In the worst case, there is no malware scanner installed on the target computer.
A reverse check fails in many cases for the same reasons (see
Chapter 3.2.3).

In the case of MicrosoftO ce documents, the real risk does not arise from the
Documents themselves, but rather with the option of adding a macro code.
Originally were and are these macros in the documents for extensions -
Thought that are not provided by the processing program itself. So can
a program code can be added with Visual Basic Access (VBA) and


functions within the document can be used. By the big
Of course, VBA's range of functions also offers a large attack vector
and options for malware developers to direct Schadco directly to the
to prepare.

Using analysis tools such as the O ce MalwareScanner ^ 2 from Frank Boldewin,
the document can be disassembled into its components.
in a Microsoft O ce document of the VBA-Co from the rest of the text
This makes it possible to de-analyze the Co without it
Document open.

The actual analysis of the code functions turns out to be very in many cases
hard to find out. Basically, malware developers try to
real functions to be disguised [8]. By converting and interleaving
lungs of functions and coded parts, an attempt is made to achieve a maximum
To create obfuscation [26] and [30, p.6f]
an anti-malware filter based on a pattern of heuristics
the.

The macro code itself only forms a kind of middleman or dropper
called [18, p.82]. This adorns the system and then charges from another,
in the Internet system, another malware according to [30, p.8]
then executed on the computer and thus creates the harmful parts of the malware
If this is successful, the computer is infected with malware.
Figure 5 shows the entire course of the attack in its individual steps.

In the years 2015 and 2016, ransomware
Also called ransomware, distributed. This is about malware, the data
encrypted on a minnished computer with strong encryption and
It makes it unusable at first [2, p.7]. The victim becomes after the successful
Encryption of the data then requested to pay an amount.
After the blackmailer has received this amount from the victim, the decision
The selection process initiated by the malware developer and the system through this
Process made reusable [14, p.87].

(^ 2) [http://www.reconstructer.org/co ](http://www.reconstructer.org/co) de.html


``
Figure 5: Angri skettederMalware. Source: Author
``
#### 2.4.1 Practical reference

In many cases, infection with ransomware has devastating consequences.
ten from the media, are hereby due to the campaigns of the malware developers
public places [22] .Because the ransom was in many
In cases of data that are important to the work process, the
ransom fee paid by malware developer [6].

The use of a ransom makes this type of crime very lucrative.
Due to the simple distribution option via e-mail and almost anonymous
Payment via viaBitCoin is an ideal platform. According to an invoice
des Forb es [17] and the Cisco TalesSecurityTeams [27], a campaigns
within one day up to $ 1,093,590 (1BitCoin = $ 419 - rate on 03/02/2015)
generate. The FBI investigated the blackmailer from April 2014 to June 2015
Raised values of around 18 million US dollars [16].

The possibility of being able to reach such immense sums has made it possible
new business model is developing, which also increases the number and professionalism


Figure 6: An order for the ransom payment after the successful
encryption. Source: Wikip edia [51]

The campaigns are increasing. This development is also evident in Germany, either
not only in the name of legitimate and existing companies the ransomware malware
shipped, but also damage the company's image itself (see fig-
education7).

Figure 7: Message on the company website after the malware has been
sender address has been sent. Source: Author

Not only the damage to the company's reputation is enormous, but also the
Responses from recipients are not to be despised.
In spam campaigns, several thousand e-mails can be sent
In one case there were already countless calls to the company headquarters [13]
Attackers don't just distribute malware, they also distribute the
Damage to the sender. Countermeasures are almost impossible.


## 3 Initial situation

### 3.1 test environment.

During work, there is regular reference to figures from day-to-day operations
This is a productive mail server, the
used daily for incoming messages.

It should be noted that the properties of the e-mail traffic differ
can depend on the most varied of factors and are subject to great variance
numbers identified as such represent a special case.
zen and inferences to determine whether there is no general behavior
ter.

All measured values are to be considered in relation to the named measuring system
This is a comprehensive analysis and a comparison of the figures with other systems
Work not considered. In order to get a representative result, the
The determined numbers are checked against available and comparable statistics
are referenced in the appropriate places.

Productive system

The measuring system used is the current Linux system
The distribution Ubuntu ^ 1 in version 14.04LTS, which is listed in table 1
Services and filters have been installed. The system operates around 753 receivers for 16

(^ 1) [http://www.ubuntu.com/ ](http://www.ubuntu.com/)


Domains. Around 107,000 e-mails are processed here every month, which
represents an annual volume of about 1,284,000.

``
Service version description
``
``
p ost x 2.11.0 A freely available mail server,
which is available under Linux / Unix
is.
``
``
amavisd-new 2.7.1 (20120429) This service offers an
place for further filter systems
on. In the measuring system,
by the virus scanner ClamAV
involved. Additional bidder
still have the opportunity to
a content check to be carried out
lead to certain file extension
Block the service
Milter implemented.
``
``
ClamAV 0.89.1 AlsMo dulamAmavisd-Newan-
hung virus scanner. This
checks the attachments for known ones
Virus patterns and heuristics.
``
``
Spamassassin 3.4.0 This refers to you
widely used spam filters,
through various filter and
Detection method for spam from
Ham can distinguish.
``
``
Table 1: Overview of the measuring systems
``
Honeyp ot system

In addition to the productive system, various metain-
formations are not used. This system takes everyone to it-
The message to the filter method is not used here. The honeyp ot-
The system is only used to capture spam and potential malware files
Files are used for later analyzes.


When installing this system, the same Ubuntu version was used,
The volume at the honeypot, with a con gured test
Domain, has an average of 7,800 emails on a day, which is about 93,600 a year
corresponds.

### 3.2 Email filtering

In order to make a statement about the measurements used, it is first necessary
to describe the measurement setup. This forms the basis for this later
and should be used as the basis for this
established and recommended measures to prevent spam and malwa
rhyme e-mail traffic be considered. In detail, the functions of the free
Anti-virus software ClamAV ^ 2 as well as the freely available anti-spam filterSpamas-
sassin in connection with the also free Mail Transfer Agent (MTA) Post x
All components are frequently used and form a composite
Widespread email and filter system.

#### 3.2.1 Methods

To better illustrate the different steps in accepting an email,
these have been divided into sections. Each represents the possibility of use
a corresponding filter. Which characteristics and restrictions are filtered
the server operator decides for itself. Here jedo chauch applies the principle,
that as little spam as possible and as much legitimate e-mail as possible, via
be told.

- Connection establishment: Within this step, it is checked whether the arriving
    The connection has a valid sender domain. Valid here means
    E.g. that the domain name can be correctly resolved
    A check of the sender's domain is globally available on the Internet
    bareReal-timeBlackholeList (RBL) performed. If the domain is on this
    If the list is found, the e-mail will be rejected.

(^ 2) https://www.clamav.net/


- Checking the content: After the first step has been carried out
    the content of the e-mail is viewed. Technologies such as
    Malware scanners for attachments and spam filters for the textual content of
    Message for use. It is checked whether the appendix contains the text
    undesired content. The definition of undesired must be
    of the spam filter of the administrator or of the company itself.
    This setting applies globally to all e-mails that enter the system.
- Check on the end user's computer: In the last instance,
    Checked the email on the user's target computer. Locally installed
    E-mail programs such as Microsoft Outlo oko derMozil la Thunderbird can
    again with its own malware or spam detection software
    Check.This filter instance provides better individuality than the above
    named global filter policy.

#### 3.2.2 Process

The measuring system is a productive system every day
E-mails received in the company environment. This is done as a MTAinster-
punching what a processing of spam as well as the business process
important email message.

``
Figure 8: Overview of the MTA structure of the measurement system. Source: Author
``
As can be seen in Figure 8, every incoming e-mail goes through in each case
First the MTA. This uses the con gured filter method on every e-mail
After the filtering, the legitimate messages are sent to the MailDeliveryAgent
(MDA) that the delivery to the corresponding mailbox of the user
This infrastructure thus forms a kind of chain that has the
that the MDA with sensitive user data is not directly available on the Internet
is.


Within the MTA, it is possible to assign the filters to a corresponding row.
This arrangement is necessary for processing speed and efficiency.
Figure 9 shows the arrangement used in the measurement system.

``
1.In the first step, Post x itself is used as a filter. This offers rudi-
mental filter methods and can already be a fast, coarse e-pre-filtering
make.
2. The following filter is the Amavisd-New. This represents a
nular filtering, however, this mostly uses meta information of the
Email and not content. In the case of this implementation,
The Amavisd-Newno is operated by the ClamAV virus scanner. This is checked
then first attach the message to malware.
3. Before the transfer was sent to the MDA, the text of the e-mail is sent from the spa
massassin checked. This creates an individual spam level for each
Message and attaches it to the email header. An evaluation of this
Level happens on MDA.
``
``
Figure 9: Filter structure within the measurement system. Source: Author
``
Rejection

In the event that an email is rejected by the MTA, the sending MTA receives
an error message from the receiving party. This error message is used to send
signals the system that the message was unsuccessful from the receiving system
has been accepted. In most cases the sieve contains an error message
and an error number, the so-called Reject-Co de. Similar procedures
imHTTP applied.

The error numbers have been standardized within RFC 3463 and
different error behaviors of the stadium [47, p.2]. The text of the error message
is freely selectable.


Filter rules

In detail, emails with different properties are rejected, i.e.
the acceptance of the message is refused to the corresponding spam level
In which cases this happens, it is clear in the following
represents.

Rejection of the e-mail by Post xand sending MTA:

- The recipient domain is not known to the MTA.
- The recipient address is not managed by the MTA.
- The message size increases 52MB.
- The server name of the sender is not valid according to RFC 952 [20, p.1].
- The sender's server name is not an FQDN.
- The sender is not a valid domain, so it cannot be resolved to an IP address.
- The sending server is known as the spam sender and is on an RBL.
- The sending server has a dynamic IP address.

In the following cases, the email to the sending MTA is sent by Amavisd-new
rejected:

- If there is an attachment with the appropriate file extension ^ 3
    ends.
- If a file has been attached to the email that was sent by the virus scanner as
    Classified as malware.

After the incoming e-mail has passed both stations, the measuring
systemno no analysis of the textual content is carried out
of the spamassas examined in the contents of the following features:

- Contains known spam URIs stored in a database available on the Internet ^ 4

(^ 3) Endings in detail: .ade, .adp, .app, .asp, .bas, .bat, .cer, .chm, .cmd, .cnt, .com, .cpl, .crt,
.csh, .der, .exe, .fxp, .gadget, .grp, .hta, .inf, .ins, .isp, .jar, .jse, .js, .ksh, .lnk, lib, .mad, .ma,
.mam, .mar, .mat, .mav, .mcf, .mda, .mdb, .mde, .mdt, .mdw, .mdz, .msc, .msh, .msh1, .msh2,
.mshxml, .msh1xml, .msh2xml, .msi, .msp, .mst, .ops, .osd, .p cd, .pif, .pl, .plg, .prf, .prg, ps1,
.ps1xml, .ps2xml, .psc1, .psc2, .pst, .reg, .scf, .scr, .sct, .shb, .shs, .sys, .tmp, .url, .vb, .vb e,
.vbp, .vbs, .vsmacros, .vsw, .vxd, .ws, .wsc, .wsf, .wsh, .xbap, .xnk.
(^ 4) [http://uribl.com] (http://uribl.com)


``
stand.
``
- Contains non-European characters.
- Statistical check of the text against a constantly updated database
    with keywords for spam (procedure see Chapter 3.2.3).
- Checking the meta information and email headers, such as the sender of the
    catcher, for irregularities.

After this instance of the filtering has also been passed, the e-mail of the spam
Level de ned. This determines that it is in the message about Hamo derSpam
A rejection of the e-mail is no longer possible in this step.
The spam level describes how high the probability is that it
It is spam. The scalar ranges from <5 = no spam, ≥ 5 = possibly
Spam, up to ≥ 15 = spam. Through each of the narrowest tests, the
Spam level of the e-mail increases accordingly. The more tests are positive,
the higher the spam level.

In each case, the message is delivered to the recipient. The spam level is set
named by the Spamassassin within the email header as X-Spam-Score and
can thus be evaluated by the next instance, the MDA.
e-mails from a spam level of ≥ 5 at the user
GramminSpam-o orJunk -Order shifted.

#### 3.2.3 Filter Technologies.

In order to better describe the filter methods used, these are
The section is not shown in the detail. The functions and
Detailed measurements descriptions.

Anti-malware filter

The Open enSource Anti-Malware Filter, ClamAV, offers a free
and the simple possibility of integration in different MTAs
Solid anti-malware base. Thanks to its users and developers,
updated malware database and heuristic approach to different


File types, work with traditional technologies.
gration and robustness is this malware scanner in connection with MTAs
widespread.

From the classical approach of the ClamAV, there is no disadvantage in relation to each
on the constantly changing malware threat. In some cases this leads to
to the fact that a detection of malware is a few days late to the whole
does not occur [44]. A quick adaptation and change of the malware
in addition to poor recognition at [50, p.20].

In order to refer to a current threat (see Chapter 2.4),
Within the honeypot system all Microsoft Oce documents are included
VAB macro code is extracted and these attachments are saved on the system.
No detailed check of the attachments with the freely available oletool ^ 5 could be
heuristic behavior pattern and contents of malware for each filed file
As a result, each of these documents was potentially malware
represents.

In the test areas of ClamAV, 191 of these different malware documents were identified
Checked every day. The malware scanner has been
position and update its de nition-
database for malware. The result of four days of observation was that 51
(26.70%) Macro malware documents not attached on the day of occurrence
The sieves have not been classified as malware after more than a day
Even the heuristic detection of harmful things integrated in the CLAMAV
VBA-Macro-Co yourMicrosoftOce documents can be accessed
is the likelihood that a message with macro malware as an attachment
is not recognized on the same day of occurrence at 30.37% (19158 = 0.3037). 24
Hours later this decreased to 3.7% (1917 = 0.037).

Figure 10 clearly shows the waves in which the spam campaigns are used
Attached malware can occur. Within these spam waves are up to
44 incoming messages per minute to be observed. If there is a probability
of 30.37% applied to 44 messages, results in 13 rounded to a whole number
(13,36) attachments of the messages per minute not recognized by the ClamAV
it is assumed that every incoming e-mail from each other

(^ 5) https://bitbucket.org/decalage/oleto ols / wiki / olevba


Figure 10: Spam campaigns with malware as an attachment - period 23.04-
May 23, 2016 Source: Author

Appendix is attached. In many cases observed by the author, each is
Campaigns always sent the same eType of malware, which the probability
an infection if this individual file is not recognized.

These numbers show that an anti-malware scanner tends to
Adhesive documents cannot be recognized as malware. Due to the high number
the amount of malware messages that wave into the e-mail system increases
the likelihood of delivery and thus also of an infection.

In practice, for example, the number of sender filters is actually used
delivered messages down, the detection rate of the virus scanner itself
In chapter 4.2.2, more precise reference is made to this.
men.

Anti-spam filter

A basis for the first anti-spam filters is the RFC 2505 from 1990
 At that time, the first measures to prevent spam were written,
which are basically meta information-oriented [28, p.6]
Document, another approach was developed to achieve a more intelligent
and has established a more focused analysis on the text. One of the pioneers
Paul Graham was in this area. Developed on the basis of the mathematical
Law of Bayesian filter is a to chastic agent against spam [19].

To distinguish spam from Ham fundamentally, the probability is
1 is denoted above 2. This means that the probability (P) that an e-mail
Spam (S) or Ham (H) is evenly distributed.


##### P (H) = P (S) = ^ 12

This definition is very static in terms of the varying distribution between
the spam and ham part of the e-mail traffic
good approximation of a practical value.

A second assumption is based on the assumption that the words considered are so chastic
appear independently. At first glance, this is a rather paradoxical assumption,
certain words often appear in contexts [39]. From this processing
of the text a word list / vector is generated [4, p.2].

The spamassassin uses this technique to send an email
to classify as the Hamo of Spam. Using the word list and the E-
Mail headers can be created by comparing over 100 test sequences within the
massassin at spam level [42].

Targeted undoing of the tests can, among other things, by means of an increase
of the e-mail text can be reached with legitimate text modules
Evaluation of the tests can no longer take place and the filter decides
in favor of the false positive rate that it is a HamE-Mail [40,
P.6]. In the simplest case, the letter end is replaced by special characters
Pictures inserted as text [3, p.7].

In addition to the dynamic analysis with the test procedures, static lists are provided
with spam URIs for use. It is an Internet-accessible Lis-
with URIs and domain names that are frequently used by spam senders.
Is there a link to a domain of the URI from this list within
E-mail text, there is a very high probability that it is about
Is spam.

Spam campaigns that have an anti-spam filter option
If the technique has been used, there is no longer any possibility of doing this
on the basis of the texts.


### 3.3 measurements.

The measuring point of the incoming MTAs was determined for the measurement.
t by analyzing the log files to obtain a detailed picture of the processing of the
outgoing messages are created. All filter instances documented each
Filter event a corresponding log file. The entries in these log files
write the reason for the aging in the case of malware or the spam result
the message.

To enable long-term analysis, the log files are archived daily
and can be used for later evaluations
were carried out with the To olsp ogsumm ^ 6 and logwatch ^ 7.
The program Mailgraph ^ 8 was used for phical processing.

The measurements even stretched over the month of April in the year 2016
this month there were no public holidays and no other exceptional event
that would have affected the e-mail traffic. The start time was it
04/01/2016 at 6:24 a.m. and the end time 04/30/2016 00:00 a.m. So
was shown in a month with 25 working days and 5 weekend days.

#### 3.3.1 Results

In the following, all measured data are presented in a processed form.
The processing here means that the non-integer data to two decimal places
rounded and personal data was removed. All data are based on the
corresponding log files and are not the result of a real-time analysis.
As mentioned, the system acts to ensure a productive and
system used. All values to the incoming
News ussdar.

(^ 6) https://jimsun.linxnet.com/
(^ 7) https://sourceforge.net/pro jects / logwatch / les /
(^ 8) [http://mailgraph.schweikert.ch/ ](http://mailgraph.schweikert.ch/)


Filtering step 1: Post x and Amavisd-new

In order to get an overview of the system, the measurement
The data of the filter instances Post x and Amavisd-new are shown in one overview
entire measurement period.

``
AnSpamassassin 74,059 68.91%
``
``
Rejected 33,414 31.09%
``
``
Total 107,470 100%
``
``
Table 2: Messages received in the measurement period.
``
From table 2 it can be seen that 31.09% of the received messages are already
are rejected directly in the first two filter instances. Only 68.91% of the
Email was sent to the spamassassin for text-based spam analysis
directs.

All rejected e-mails are e-mails that were not intended for
Recipients have been delivered and rejected. Sending server server
receives a corresponding message from the MTA that the acceptance was refused-
de.

Table 3 provides a more detailed list of the reasons for rejection
These are divided into the following categories:

- Connection errors: This type is messages that are
    were already rejected during the connection attempt. Mostly are here
    wrong or the missing server name of the sender or the disconnection, as
    Port scans are also the reason.
- Address verification: The e-mail address of the recipient was
    Target system not found. Thus, delivery to one does not exist
    Mailbox not targeted and therefore the email is rejected.
- RBL: If an email is posted on one of the RBLs available on the Internet,
    it can be assumed that this is spam
    E-mail is therefore rejected.


Figure 11: Number of e-mails to the measuring system with the corresponding
Gen. Source: Author

- Blocked file extensions: The Amavisd-new filter is used for filtering
    the attachments and refuses to accept them with forbidden file extensions.
    Figure 11 shows the distribution of the different file extensions
    The file settings.js for JavaScript files as well as.ex for executing
    Bare programs have been rejected here included. Both are with
    high probability of malware [14]. The.crt ending is for a
     kats file, which isnormally not sent via e-mail, and therefore also
    has been rejected.
- Malware: This rubric deals with rejections made by
    Amavisd-new be carried out if a virus is detected by ClamA-
    de.


``
Connecting
error
``
``
Address
Verification
``
``
RBL blocked
Files-
fertilize
``
``
Malware sum
``
##### 3,162 3,154 26,259 836 3 33,414

##### 9.46% 9.44% 78.59% 2.50% 0.01% 100%

``
Table 3: Distribution of the rejected messages
``
Filtering step 2: Spamassassin

The 74,059 emails that remain after filtering step 1 will now be sent
Checked by the spamassassin. This has the task of keeping the messages within
Spam properties recognized in their meta information and textual content
According to this classification, 4,713 (9%) passed through this filter
Marked as spam because you had the corresponding characteristics of a spam e-mail
The remaining 69,346 (81%) of 74,059 have now become the corresponding recipients
Delivered without a spam tag (Figure 12).

``
Figure 12: Filtering of the spamassassin. Source: Author
``
If you take all the filtering steps together, that's 69,346 emails per month
April 2016 to 753 recipients. This means that the recipients are distributed around 92
Emails per month.


#### 3.3.2 Summary of measurements

In the total of all filter instances there are 38,127 messages that either
Declared as spam, which has already been rejected. Percentage confirmed
The share of unwanted e-mails in 107,473 messages is 35.48%
The statistics from Symantec show the global mean value for a company with 501-
1000 employees around 53.5% (Figure 13).

``
Figure 13: Spam report from Symantec. Source: Symantec [41]
``
Thus, the measurement system is 18.02% behind that published by Symantec
Pay what is to be neglected, because it is not explicitly
but instead use global numbers for the determination and
There is a large variance. The extent to which an email is sent within the
64.52% was incorrectly not marked as spam (false positive) remains
hiero en.

### 3.4 Representation of the decit.

The above mentioned filtering methods and processes for preventing spam
Compared to Symantec's global statistics, malware shows that around
50% of the e-mails received contain spam, but it will keep coming back
to prevent e-mails from being recognized by the filter instances.

The current filtering methods offer many possibilities to receive e-mails
To examine features, however, it is always up to the operator, as it is restrictive
he uses this. A severe restriction of the reception inevitably leads
to increase the false positive rate regarding ham emails. That means that


Legitimate e-mails are recognized as spam by the system, which from the user's point of view is very
is negative. The statistics drawn from the measurement system show that the mean value
the spam level that the spam assassin assigns to a ham e-mail, at a value
If the level is ≥ 5, the e-mail is marked as spam and lands
thus in the spam folder of the user. 3.107 e-mails entered in the measurement period
Reached level 4. We would therefore apply a more restrictive set of rules and
If you lower the level for a spam message to ≥ 4, these emails would be considered as
Spam flagged to be delivered to the user.

When looking at Amavisd-new and Post x, the consequences of a false
Positive detection is associated with a rejection and thus the e-mail
Not accepted at first. The sender receives an error message that the
E-mail was not delivered. The block applied in the case of the measuring system
of certain appendices (see Chapter 3.1) also has an impact on the
Communication with customers, for example, by fundamentally blocking Microsoft
O ce documents with an active VBA macro code can consequently use the
E-mail communication with business partners can be sensitively disturbed
A survey in a customer system revealed that 464,150 messages
with Microsoft O ce documents 9,863 legitimate macros included.
A more restrictive approach and the blocking of such documents would
the sender will be rejected, resulting in the associated business process
would prevent.

This method, Microsoft O ce documents with an active VBA macro code
block, each is often given as a countermeasure for macro malware
b en [9, p.11] and [48, p.5]. Based on the determined numbers, these seem to be each ch
not expedient for the mapping of a business process based on documents
with VBA macros based.

A release of the corresponding communication partner from this filter
due to the possibility of forging the sender in e-mails,
It is even worse that there is no user here
Security is simulated and the likelihood of opening the
If this blocking rule is not activated, you can also
Inevitably, the type of malware described in Chapter 2.3. This results in one
Dilemmas between allowing potentially dangerous attachments and
negative impact on daily business processes.


In summary, it can be seen that the established filter methods are very important here
starres,ab ere zientesKonzeptbieten[1,S.4 ].SiebildeneinensolidenGrund-
schutz können jedo chnicht  exib el unddynamischauf neue o der sich ändernde
Bedrohungenreagieren.


## 4 NeueAnsätze

### 4.1 RückschlüsseausdenMessergebnissen

DieerbrachtenErgebnisselassendaraufschlieÿen,dassdieklassischenFiltermetho-
deneineBasisbietenundauchb ereitsschoneinGroÿteilderBedrohungeneliminie-
renkönnen.Jedo chwandeltsichdieBedrohung,wieinKapitel2.4.1b eschrieb en,
ständig.ZudemetabliertsichwährendderFilterungzwangsläu gaucheineArtQua-
litätsprüfung.Diesb edeutetb eieinerNichterkennungeinermitSpamo derMalware
b ehaftetenE-Mail,dassdieseeineerhöhteQualitätaufweisenmuss.Dasmussnicht
zwangsläu g zueinererhöhtenWahrscheinlichkeitführen,dasseine Infektioner-
folgt,jedo chwirdeshierb eifürdenBenutzerauchschwererdieseNachrichtenals
Spamzuklassi zieren.BeieinerzugestelltenE-MailmitMalwareimAnhangb e-
stehtdieletzteFilterinstanzdarin,dassderBenutzerdiesealssolcheerkenntund
denAnhangnichtausführt.AutomatisierteMetho denhab eninsoeinemFallkeine
Anwendunggefunden.

### 4.2 NeueWegederErkennung

Aufbauendaufdem FundamentderexistierendenFiltermetho denwurdensich in
dieserArb eitmitneuenAnsätzenauseinandergesetzt.ImFokusstehthierdieImple-
mentierungeinfacherMetho den,diezumexistierendenSystemhinzugefügtwerden
könnten.EntstandensinddieseMetho dendurchdieBeobachtungundAnalyseder
ermitteltenMesswerte.ZusätzlichwurdenProblematikenundErkenntnisseausdem


```
Abbildung14:FürdenBenutzero ensichtlicheSpam-Nachricht.Quelle:Autor
​```
Betriebsalttagmiteinb ezogen.EinBeispielhierfüristdieAusarb eitungdesKonzep-
teszurVerhinderungvonMalwareinMicrosoftO ceDokumenten.Dieseswurde
auseinerProblematik(siehe3.4)ausdemBetriebsablaufherausentworfenundstellt
somiteinesehrnaheBindungzueinemrealenProblemdar.

#### 4.2.1 VerhinderungvonSpamdurchb ekannteAbsender.

AusderAnalysedesSpam-VerhaltensanhanddesMesssystemkonnteermitteltwer-
den,dass35,48%derNachrichtenalsSpamvonkonventionellenFiltereinrichtungen
erkanntwurden.Jedo chb estehtimmerwiederdasProblem,dassSpam-Nachrichten
alsFalse-NegativandenBenutzerzugestelltwerden.

InAbbildung 14 konntedieNachrichtnichtvondenautomatisiertenFilterinstanzen
aufdemMesssystemerfasstwerden.DerTest,obvomAbsenderdieAbsenderadresse
vergessenwordenist,b ewertetderSpamassassindieE-Mailhierb eip ositivmit2,095
und1,552 (FREEMAIL_FORGED_REPLYTO undREPLYTO_WITHOUT_TO_CC)als Spam.
Zusätzlichkommenno cheinefehlerhafteAu ösungderAbsender-Domainmit0.792
(RDNS_NONE).Daraus ergibtsicheinSpam-Levelvon 4,438.DerBayes_00-Test^1
verringerthierb eijedo chdengesamtenSpam-Levelum-1,9Punkte,daerausdem
TextkeineSpam-Eigenschaftenermitteltworden.DieseVorgehenwirdzuGunsten
derFalse-Positiv-Ratedurchgeführt.Esergibtsichaus4,438-1,9einSpam-Levelvon
2,538was<5istundsomitdieNachrichtnichtalsSpamklassi ziertwird,obwohl
siediesnachweislichseinsollte.

(^1) https://wiki.apache.org/spamassassin/Rules/BAYES_00


```
Listing4.1:PositiveTestsdesSpmassassinmitBewertung
X - S p a m - T e s t s : B A Y E S _ 0 0 = - 1. 9 , F R E E M A I L _ F O R G E D _ R E P L Y T O = 2. 0 9 5 ,
R D N S _ N O N E = 0. 7 9 3 , R E P L Y T O _ W I T H O U T _ T O _ C C = 1. 5 5 2
​```
FürdenBenutzeristhierimBeispiel(Abbildung14)klarerkennbar,dassessichum
Spamhandelnmuss.InvielenFällenwirddiesausdemKontextersichtlich.Dieser
entstehtausdemAbsendersowieInhaltderE-Mail.DerBenutzerschlieÿtausdiesen
b eidenInformationen,obessichumeineHam-o derSpam-E-Mailhandelt.

DieseeinfacheAuswertungob,diederBenutzermeistunterb ewusstfürjedeE-Mail
durchführt,lässtsichineinMTA-Filter-Systemüb erführen.Hierzusindkeineho ch
komplexenAlgorithmennötig,sonderneinedynamischwachsendeDatenbankmit
allenEmpfängeradressenausgehenderE-Mails.ImDetailmüsstedieseDatenbank
vomausgehendenE-Mailsystemb efülltwerden.SobaldeineE-Mailaneinenexter-
nenEmpfängergeht,wirddieseE-Mailadressealsb ekanntinderDatenbankhin-
terlegt.HierauserzeugtsicheinedynamischwachsendeWhitelist,diealleKommu-
nikationspartnerau istet.DieseDatenbankwirddemSpamassassinzurVerfügung
gestellt,derdannsomiteinweiteresBewertungskriteriumb ekommt.

SokanndurchdieAnalysedesTextesundderE-Mail-HeaderderSpam-Filterschon
eineguteEinschätzungliefern.Solltejedo chdieEntscheidungzweifelhaftausfallen,
wieob enb eschrieb en(Spam-Levelzwischen 0 und5),könntedieseDatenbankeine
weitereEinscheidungsgrundlagebieten.IneinemerstenTestmit 35 False-Negativ
Spam-Nachrichtenwurdeermittelt,dassalledurchdieseMetho deerkanntwerden
könnten.DerSpam-Levellagb eijedergetestetenE-Mailzwischen 0 und4,9.

InnerhalbdesSpamassassinwerdenähnlicheFunktionenschonverwendet.DieAuto-
Whitelist-FunktionmerktsichimmerdenletztenSpam-LeveleinesAbsenders.Ein
Beispielwärehier,wennBobeineSpam-E-MailmitLevel 10 sendet,wirddiessoin
derDatenbankvermerkt.SchicktBobeineweitereE-Mail,dieab ernureinLevelvon
2 hat,wirddieservomaltenWertabgezogen.Also10-2=8,wob ei 8 dasneueLevel
ist[46].BeiderBeobachtungamMesssystemzeigtsichdenno ch,dassimMesszeit-
raum21.439Absendereingehendvermerktwurden.Hiervonhab enjedo chnur4.744
mehralseineE-Mailgesendethab en.16.695Absender(77,87%)hab enausschlieÿ-
licheineE-Mailüb ermittelt.Darausergibtsich,dassb ei4.744(33,23%)lediglich
einMehrwertdurchdasWhitelistingentsteht.AlleanderenEinträgewürdeninder
Datenbankverweisen, dakeine weitereE-Mailmitdemselb en Absenderempfan-


genwird.Häu ghandeltessichumSystem-o derSpam-E-Mails,dieautomatisiert
generierteAbsenderaufweise.

Derb eschrieb eneueAnsatzinvertiertdiesesVorgehenundkönntehierb eieineb es-
sereErkennungeinerschonvorhandenKommunikationliefern.DieWahrscheinlich-
keit,dasseineKommunikationaufgrundeinerSpam-E-MailmitdemSpamversender
statt ndet,istvernachlässigbar.ZudemwürdedieseErweiterungderErkennungerst
eingesetztwerden,wennderSpam-LevelineinemSchwellenb ereichzwischen 0 und
4,9desSpam-Levelsliegenwürde.Ob erhabundunterhalbdiesesBereicheswürde
dieseDatenbanknicht füreineweitereBewertungder E-Mailherangezogen wer-
den.

ImBeispielwürdeBobanAliceeineNachrichtsenden.DieseNachrichterhältam
Spam-Filtereingehendden Spam-Level-1undwirdanAlicealslegitimeE-Mail
zugestellt.AliceantwortetaufdieseNachrichtundsomitwirdüb erdenAusgangs-
serverdieEmpfängeradresse indieDatenbankeingetragen.SendetBobnuneine
weitereNachrichtmitdemSpam-Levelvon4,8anAlice,würdederEintraginder
Datenbankdie Nachricht alsHam erkennen,da schon eine ausgehendeKommu-
nikationmitBobundseinerE-Mailadresse stattfand.Fallsjedo cheineNachricht
einesSpam-VersendersmiteinemniedrigenSpam-Levelvon3,2vomSpamassassin
erkanntwird,kanndieseNachricht,aufgrunddesfehlendenEintragesderAbsender-
adressedesSpam-VersenderinnerhalbderDatenbank,b esserb ewertetwerden.Eine
ErhörungdesSpam-Levelsum 3 PunktedurchdiezusätzlicheBewertung,würdein
solcheinemFalldieNachrichtalsSpammarkieren.

GenerellistdieserAnsatzaneinemGreylisting(RFC6647)angelehnt[24,S.3 ].
Hierb eiwerdenhierNachrichtentemp orärb eimerstenSendenvom empfangenen
MTA zurückgewiesen. Der sendende MTA versucht nach einer Zeitspanne dann
no chmalsdieNachrichtandenempfangenenMTAzusenden.NachdemzweitenVer-
such,wirddieNachrichtvomempfangenenMTAdannendgültigangenommenund
derAbsenderineinerDatenbankhinterlegt.SendetdieserAbsendernunno chmals
eineNachricht,wirddieseaufgrunddesDatenbankeintragsdirektangenommen.Die-
sesVorgehensollSpam-Versenderabhalten,dadieseeventuellnichtversuchendie
Nachrichteinzweitesmalzuzustellen.Problemist,dassdergesamtenNachrichten-
 ussb eiunb ekanntenAbsendernstarkverzögertwird.Zusätzlichist dieE zienz
sehrgeringeinzuschätzen[11,S.5]undSpam-undMalware-Versenderhäu gdieses
Vorgehenvorhersehenunddurchno chmaligessendenausheb eln[31,S.6].


Beidemausgearb eitetenAnsatzwirdimDetailnichteineunb ekanntenDatenbasis
verwendet,sonderndieb ekanntenundlegitimenAbsenderderausgehendenNach-
richten.SoentstehteineschlechtereBewertungeinerNachrichterst,wennsiedem
Systemnichtb ekanntist.BeidiesemAnsatzwirdsoauchdieMöglichkeitgenom-
men,dasSystemdurchsendenvonentsprechendpräpariertenE-MailszuManipu-
lieren.EineErweiterungderDatenbankistnurüb erdasausgehendeSystemmög-
lich.

Aus technischer Sicht, müsste der Spamassassin lediglich eine Schnittstelle bie-
ten,worüb ervertrauenswürdigeSystemeAbsenderinderDatenbankb ekanntgeb en
könnten.

```
Abbildung15:KonzeptfürdieEinbindungderAbsenderdatenbank.Quelle:Autor
​```
Eswurdeermittelt,dassb eidenausgehendenE-MailsimMonatrund4.280Absen-
derverwendetwerden.Dasheiÿt,dass4.280verschiedene Adresseninnerhalbder
Datenbankvermerktwurden.DieseZahlhältsichsehrkonstant.ZwischendemMo-
natAprilundMai 2016 wurdeninderE-Mailinfrastrukturlediglichnur 230 neue
Adressenregistriert.ImJahrsinddasho chgerechnetrund2.760b eiderAnnahme
einerkonstantenWachstumsratevon 230 imMonat.Imb estenFallhab enalleEin-
trägeeinVerfallsdatum, dassdenEintraginvalidiert,fallserseitmehralseinem
Jahrnichtmehrb eobachtetwerdenkonnte.BeidiesenEinträgeninderDatenbank,
kannvoneinereinmaligenKommunikationgespro chenwerden.

#### 4.2.2 VerhinderungvonMakro-Malware.

Die inKapitel2.3b eschrieb eneWandlungvomAusnutzenvonSchwachstellen in
Programmeno der Protokollenzieht sich hinzur Schwachstelle Mensch.Umdie-
seSchwachstelle b esserautomatisiertzuschützenwurde einAnsatz mithilfevon


AnalysenderDateiinhalteentwickelt.

BeidiesemAnsatzwirdzusätzlichvomVirenscannerjederankommendeAnhang
einerE-MailaufeventuelleMalware-Eigenschaftengeprüft.ImDetailwirdderFokus
aufdieDokumentdateityp enderMicrosoftO ceProgrammfamiliegelegt,diedurch
.doc/.docx,.xls/.xlsxund.rtfb eschrieb enwerden.Siestellenmit88%einen
Groÿteilder legitimen Anhängedar. Beiden restlichen12% handelt essich um
komprimierterArchiveim.zip-Format(sieheAbbildung11).

DurchdieMöglichkeit,VBA-Co deindiesenDokumentenzuimplementierenstel-
lensieeinp otentielleGefahrdar.DieerkanntenDe zite(Kapitel3.4)deraktuelle
eingesetztenFiltermetho denkönnendieseArtvonBedrohungnachweislich(Kapitel
3.2.3)nichteliminiert.

ImFokusdiesesAnsatzes,solldiedynamischeundnichtaufVirus-Patternbasie-
rendeAnalysedesVBA-Co desinnerhalbderDokumentestehen.Nursokanneine
zuverlässigeErkennungb eischnellwechselndenMakro-Inhaltengeschehen.DieEr-
kennungselbstsollkeinedirekteVerhaltensanalyseo derInterpretierungdesCo des
sein.Vielmehrwirdhierb eidieArtdesQuellco desunddieverwendetenFunktions-
aufrufeb etrachtet.

AlleWerteb eruhenaufAnalysenvon 25 unterschiedlichen,fürdenUnternehmensab-
laufwichtigenMicrosoftO ceDokumentenmitMakros.Ihnengegenüb erstanden
526 mitMalwareb ehaftete.Ausdiesenwurdeermittelt,welcheArtenvonFunkti-
onsaufrufenmiteinerhohenWahrscheinlichkeitnichtinlegitimenMakrosenthalten
sind.DieseAuswertungwurdedurchdieAnalysenvonAlexanderGazet[18]und
vomMicrosoftMalwareProtectionCenter[29]weiteroptimiert.DieGegenanalyse
von gutartigenMakrosergab,dassdieseineinigenPunkten di erenzierbarsind.
Abbildung 16 zeigteinBeispieleinesinVBAgeschrieb enenMalware-Co des.Man
kannhiererkennen,dassmitverschiedenenMetho denversuchtwird,dieeigentliche
Funktionzuverschleiern.EinBeispielwärehierb eidieVerwendungvonHexadezi-
malzahlenundzufälliggenerierteFunktionsnamenimCo de.

AusdenAnalysenderDateienkonnteeinAusgangsheuristikfürMalware-Dokumente
de niertwerden.FürdieAnalysederDateienwurdedasTo olsetpython-oletools^2
vonPhilipp eLagadecverwendet.DiesebieteteineguteMöglichkeit,Dokumenteauf
dieseArtvonFunktionsaufrufezuuntersuchen.

(^2) [http://www.decalage.info/python/oleto](http://www.decalage.info/python/oleto) ols


```
Abbildung16:VBA-Co deeinerMalware.Quelle:Autor
​```
FolgendeEigenschaftenundFunktionsaufrufekönnenineinemDokumentmitMal-
wareVBA-Co degefundenwerden:

- SobalddasDokumentgeö netwird,wirdeinFunktionsaufrufdurchgeführt.
- HerunterladeneinerDateivoneinerURL.
- EineDateiwirdgelöscht.
- EineDateiwirdangelegt.
- VersuchteineDateio derProgrammaufdemSystemauszuführen.
- VersuchteineKommandozeilezuö nen.
- VersuchteinSystemprogrammauszuführen.
- EineDateiwirdkopiert.
- DerCo deb einhalteteHexadezimalText.
- DerCo deb einhaltetBase64Text.
- VerschleierungenmitderFunktionChr()^3.

Die gelisteten Funktionsaufrufestellendie Ausgangsheuristikdar, sindjedo ch in
dieserFormnichtgewichtet.ZusätzlichmüssendieseFunktionsaufrufeundEigen-
schafteninderKombinationihresAuftretensb etrachtetwerden.DieKlassi zierung
ausschlieÿlichaufeinerdieserFunktionsaufrufewürdenichtzielführendsein,dadiese
imEinzelfallauchinlegitimemCo deenthaltensind.

(^3) https://msdn.microsoft.com/de-de/library/613dxh46%28v=vs.90%29.aspx


```
Vorgang legitimenDokumente Malware-Dokumente
Auto-StartdesMakro 11 15
Dateilöschen,kopieren,erstellen 12 28
Programmaufruf 2 27
Dateiherunterladen 1 24
Kommandozeileö nen 1 28
Systemprogrammaufruf 0 28
HexadezimalText 0 497
Base64Text 0 494
FunktionChr() 0 492
​```
Tab elle4:Anzahl der legitimen und Malware Dokumenten mit Auftreten der
Funktionen

InTab elle 4 isteineTendenzder 526 untersuchtenMalwareDateienzudenunter-
schiedlichenFunktionenzusehen.Rund 490 dieseDateienweisendieVerwendung
vonHexadezimalzahlen,Base64,sowiemitderChar()-Funktionco diertenTextauf.
Innerhalbdieser 25 legitimenDateienkonntekeinedieserFunktionengefundenwer-
den.Jedo chgilteshierzub eachten,dassdieseAuswertunggegenüb ereinergerin-
genAnzahllegitimerMakro-Co deteilestehtundsomiteinesp eziellenFallreprä-
sentiert.UmdieseAuswertungzuverallgemeinernwirdeinvereinzeltesAuftreten
dieserFunktionsaufrufe no chnichtzurKlassi zierungdesDokumentsalsMalwa-
reverwendet.Funktionen,wiedasÖ nenderimMicrosoftWindows integrierten
Kommandozeile sowiedas Herunterladenvon Dateien,kann inEinzelfällen auch
imlegitimenCo deb eobachtetwerden.Betrachtetwerdenmüssendieseverdächti-
genFunktionsaufrufeineinerHäufung.ErstwennimCo demehrfachz.B.Base64
o derHexadezimalzahlenverwendetwerden,steigtdasPotentialMalwarezusein,da
hierdurchCo de-Teileverschleiertwerdenkönnen.

GrundlegendergibtsichdieBewertungausdemGefahrenp otentialderFunktionen.
DasreineErstellenz.B.einerDateistelltkeinedirekteGefahrdarundwirdsomit
geringerb ewertet. EinemehrfacheVerwendungderChar()-Funktionjedo chlässt
dieVermutungsteigen,dasshierdurchFunktionenundCo de-Teileverschleiertwor-
densind.FunktionenwiedasAufrufenvonSystemprogrammehingegenwerdenb ei
einmaligemAuftretenschonalsstarkverdächtigangesehen.

UmdieseGefahreneinstufungdarzustellen,wurdeeineSkalavon 1 bis 10 de niert.
Hierb eiwirdmit 1 einegeringeGefahrsowiemit 10 einehohedargestellt.Hierauser-
gibtsichdieBewertungstab elle 5 mitderentsprechendenGefahrenb ewertung.Tritt


somiteineKombinationdieserFunktionenauf,werdendieWerteaddiert.Enthält
alsoeinMicrosoftO ceDokumenteinMakro,daseineDateiunddieKommando-
zeileö netsowiezusätzlicheinenDownloadstartenwill,erhältesdieBewertung
2+8+5=15.

```
Vorgang Gewichtung(1-
10)
description
Auto-StartdesMakro 2 AucheinlegitimerCo dekanndieseFunktionb einhal-
ten.
Dateilöschen,kopieren,erstellen 2 AucheinlegitimerCo dekanndieseFunktionb einhal-
ten.
Programmaufruf 5 KannineinlegitimenCo devorkommen,sollteesim
b estenFallab ernicht.
Dateiherunterladen 5 EinNachladenvonInhaltenstellteinRisikodar.
FunktionChr() 5 DieserAufrufkannein-biszweimalimlegitimenCo de
Vorkommen.
Kommandozeileö nen 8 DieserVorgang sollte selten in einemnormalen
Makro-Co devorhandensein.
Systemprogrammaufruf 10 DieserAufrufkommtseltenineinemlegitimenCo de
in front.
HexadezimalText 10 DieserAufrufkommtseltenineinemlegitimenCo de
in front.
Base64Text 10 DieserAufrufkommtseltenineinemlegitimenCo de
in front.
​```
​```
Tab elle5:AnsatzzurGewichtungderFunktionsaufrufeimMakro-Co de
​```
NachdemdieE-MaileinenentsprechendeBewertungerhaltenhat,wirddiesegegen
einenglobalde niertenWertgeprüft.DieserSchwellenwertb estimmt,ab welcher
Gefahrenb ewertungdesMarkos,dieE-Mailzurückgewiesenwird.DieserSchwellen-
wertwurdeausderAnalyseder 526 Malwareund 25 legitimenDokumentenerstellt.
Hierb eiwurdezunächstderMaximalwertderlegitimenDokumenteermittelt.Dieser
lagb ei 12 Punkten.ImGegensatzzumMaximalwertwurdeno chderMinimalwert
derMalwareb ehaftetenDokumenteermittelt.Dieserlagb ei 14 Punkten.

AusderAnalysederMaximal-undMinimalwerteergibtsicheinSchwellenwertvon
13 Punkten.WirddieservoneinemDokumentmitMakro-Co deüb erschritten,wird
dieNachrichtandenAbsenderzurückgewiesen.

NachderAnalysederDateienundderDe nitionderHeuristik,alsauchdesSchwel-
lenwertes, wurde die Implementierungsmöglichkeit am MTA b etrachtet. Hierb ei
muss b eachtet werden, dassdiese indie aktuelle MTA-InfrastrukturundFilter-


metho den eingebundenwerdenmuss.FürdieseAufgab eisteine Verwendungder
Milter-SchnittstelleimPost xalszielführendanzusehen.DiesebietetdieMöglich-
keit,dieE-MailaneinenFilterweiterzugeb en,ohnedieNachrichtvollständigan-
nehmenzumüssen[53].

```
Abbildung17:PositiondesMacroMiltersimE-Mail uss.Quelle:Autor
​```
WieinAbbildung 17 zusehenist,wirddieNachrichterstindieEmpfangs-Queue
fürdieWeiterverarb eitunggegeb en,wenndieAnalysedesAnhangsabgeschlossen
ist.UmeinAnhangnichtdopp eltanalysierenzumüssen,istderEinsatzeinerDa-
tenbank mitb ekannten Malware-Anhängen alszielführend zub etrachten.Durch
die HinterlegungdesHash-Wertesdes Malware-Dokuments, kann b eieinem wie-
derholtenAuftretendiesesofortalsMalwareklassi ziertundsodieDurchlaufzeit
verringern.

FolgendeSchrittesindfürdieAnalysederAnhängenötig:

```
1.E-MailvomPost xviaMilter-Schnittelleweiterleiten.
2.AnnehmenderFilterextrahiertdenAnhang.
3.Prüfenob,essichumeinMicrosoftO ceDokumenthandelt.
4.Prüfenob,einMakro-Co deenthaltenist.
5.DynamischePrüfungob,Makro-Co deaufdasMalware-Heuristikpasst.
6.E-Mailb eieinemp ositivenFundviaPost xanSenderzurückweisenundHash-
WertinderDatenbankvermerken.
​```
FürdieErmittlungderE zienzundAnwendbarkeitdiesesAnsatzeswurdehiervom
AutoreinekonkreteImplementierungbasierendaufdiesemAnsatzdurchgeführt.Die
ImplementierungselbstwurdeunterdemNamenMacroMilter^4 erstellt.Grundlegend

(^4) [http://sbidy.github.io/MacroMilter](http://sbidy.github.io/MacroMilter)


spiegeltdieserallehierermitteltenBeschreibungendesAnsatzeswieder.

Messung

DerausdemAnsatzresultierendeMacroMilter wurdezusätzlichimMesszeitraum
(April2016)indasMesssystemimplementiert.SomitkanneineexakteAnalyseder
E zienzdes Ansatzesgegenüb er denklassischen FilterinstanzendesPostifx und
Amavisd-New erstelltwerden.UmdasDe zitgegenüb erdiesenb essersichtbarzu
machen,wurdederMacorMilter erstnachdemAmavisd-New eingebunden(siehe
Abbildung18).SomiterreichtendenMacroMilter nurNachrichten,dievondiesem
nichtge ltertwordensind.

```
Abbildung18:PositiondesMacroMiltersinderFilterkette.Quelle:Autor
​```
DieAnalyseergab,dassimMesszeitraumaufdemMesssystem 91 E-Mailsmitei-
nem p otentiellenMalware-Co deinnerhalbeinesMicrosoftO ce Dokumentsvom
PostifxundAmavisd-Newnichterkanntwurden.Hierb eikonntekeinerdervorgela-
gertenFilterdieseE-MailsalsMalwareo derSpamklassi zieren.Zusätzlichweisen
83 (75,70%)dieserNachrichteneinenSpam-Levelvon<5aufundwärensomitim
PosteingangdesBenutzersgelandet.NurachtE-Mailshab eneinenSpam-Level≥5.
WährenddesMesszeitraumeswurdenureineNachrichtalsFalse-NegativvomMa-
croMilter erkannt.DarausergibtsicheineFalse-Negativ-Ratevon1,12%,wasals
sehrgeringzub etrachtenist.

InderAbbildung 19 sinddieerfasstenDateiendungendargestellt.Hierb eiwurden
die Zurückweisungendes Amavisd-New undMacroMilter zusammen dargestellt.
ImFalleder 11 .zipZurückweisungen,wurdeeinMicrosoftO ceDokumentmit
Malware-Co deinnerhalbdeskomprimiertenOrdnersgefunden.

AufdenGesamtanteilallerzurückgewiesenenNachrichtengesehenistderAnteildes
MacroMiltersgeringe0,27%.Jedo chgehtvondiesen0,27%eineerhöhteGefahraus,
dadiesevomVirenscannerundSpam-Filternichterkanntwurden.


Abbildung19:Kombination desAmavisd-New undMacroMiltersfürdie zurück-
gewiesenenE-MailsmitdenentsprechendenDateiendungen.Quelle:
Autor

ImweiterenVerlaufkonntensoseitdem01.Februarbis01.Juni 2016373 Dateien
ampro duktivenE-MailserveralsMalwareklassi ziertwerden.DasmachtimMonat
94 (93,25)erkannteNachrichtaus.

Zusätzlichkonnteb eidieserBeobachtungfestgestelltwerden,dassdieAngri eim-
merinWellenstatt nden.DieAuswertungderMacroMilterStatistikamHoneyp ot-
Systemergab,dassdiemeistenAngri sversuchean Arb eitstagenvonMontagbis
Freitagzwischen11:00und14:00Uhrstatt nden.DieseWertekönntenalszusätz-
licheBewertungsgrundlagederAnhängeein ieÿen.

TrotzderVorhaltungdereindeutigenHash-Wertejederschonüb erprüftenDatei,
kanneinestarkeVarianzinnerhalbderDateienb eidenAngri swellenfestgestellt
werden.Abbildung 20 zeigtdieAnzahlderunterschiedlichenMicrosoftO ce Do-
kumenteamTagüb ereinenlängerenZeitraumhinweg.

InnerhalbdesAnsatzeswurdeb ewusstaufeinenselbstlernendenAlgorithmusver-
zichtet.EinTrainierendiesesAlgorithmuswürdeaufgrundderkleinenDatenbasis
vonlegitimenMakro-Dokumentenerschwertwerden.Zusätzlichistdurchdenstati-


Abbildung20:AnzahldereindeutigenMalware-DokumenteamHoneyp ot-System
imMonatMai2016.Quelle:Autor

schenAnsatzfürdieBewertungaucheinehöhereSicherheitgegenManipulationen
gegeb en.


## 5 Schlussb etrachtung

### 5.1 VergleichzuanderenAnsätzen.

DiegenanntenAnsätzesindsehrrudimentärundeinfachinderImplementierung.
Andere,meistkommerzielle,verfolgenandereWegefürdieVerb esserungderErken-
nung.

Einer dieser kommerziellen Ansätzeist es, denFokus aufeine inder Cloudb e-
reitgestellteAnalyseplattformzulegen.DerSoftwareherstellerAvira^1 hatseinPro-
duktp ortfolio auf die neuen Bedrohungenvia E-Mailangepasst undbietet neue
MöglichkeitenzurAnalysevonDateieno derE-Mailsindervonihnenb etrieb enen
Cloud. Hierb eiwerden b ei einernegativeno der ausbleib endenBefundeiner Da-
teidurchdenlokalenErkennungsalgorithmusdiesezurerweitertenAnalyseineine
Cloudgesendet.InnerhalbdieserCloudwerdendannintelligentereundaufwändigere
Analyseverfahrenangewendet,umdieDateizuklassi zieren.

AndereAnsätze verfolgeneine Verhaltensanalyseder Malware-Programmedurch
dasAusführeninSandb oxeno deranderenabgeschlossenenContainerinfrastruktu-
ren[32, S.93]und[5,S.4 ].DerHerstellervonE-Mail-Filter Proofpoint^2 bietet
diesenDienstauchinnerhalbeinerCloud-Lsöungan.Hierb eiwirdderAnhangeiner
E-Mailno chzusätzlichaufunterschiedlichenBetriebssystemenvirtuellinderCloud
ausgeführtunddieVerhaltensweisederSchadsoftwareanalysiert.SokanneineVer-
haltensanalysedurchgeführtwerdenundeswirddab eidynamischb ewertet,obdie
DateieineGefahrdarstellto dernicht.

(^1) https://www.avira.de
(^2) https://www.pro ofp oint.com/


Beib eidenVorgehensweisen,kannb eiderschnellwechselndeMalware-Bedrohung
einLaufzeitproblementstehen.EineAnalysederDatenmussinjedemunb ekann-
tenFalldurchgeführtwerden.Dasb edeutet,dassjedeDatei,diedenE-Mailserver
passiert,p otentiellalsBedrohunggesehenwerdenmuss.Somitwirdjede,demFil-
terlokalunb ekannteDateiindieCloudgesendetunduntersucht.Darauskanneine
DurchlaufzeitdesAnhangvonbiszusechsMinuten(imFallProofpoint)entstehen,
bisdieAnalyseeinErgebnisermittelthat.WiedieErhebungausKapitel4.2.2b e-
stätigt,werdenzu88%nurDokumenteversendet.Dokumentehab endurcheinfaches
VeränderndesTexteseinesehrschnelleÄnderungscharakteristik(sieheAbbildung
20).SeitFebruar 2016 konntenimHoneyp ot-Systemrund1.030grundlegendunter-
schiedlicheMakrob ehafteteDokumenteregistriertwerden.WieguteinFilterdieser
ArtmitderMasseanDokumentenumgehenkann,giltesno chzuanalysieren.Frag-
lichist,obesinBezugzumDatenschutzhierb eino cheineFragestellungzuklären
gibt.

ImkommerziellenUmfeldistindennächstenJahreneineFokussierung aufdiese
Cloud-undSandb ox-Lösungenzuerwarten.MarktführendeHerstellerwieCisco^3 ,
Fireeye^4 undProofpoint^5 sindhierb eischonmitentsprechendenPro duktenvertre-
ten.

ImGebietderSpam-VerhinderunggibtesweitreichendeArb eitenimBereichder
künstlichenIntelligenz.Hierkanndurchentsprechendetextverarb eitendeAlgorith-
men einehoheundkorrektereErkennungerzeugtwerden[10, S.7].EineDurch-
dringendieserTechnologieindiePro duktefürkleinebismittlereUnternehmenist
erstindenkommendenMonatenzuerwarten.Zumeistwerdendieseno chaufgrund
derRechenkapazitätinGroÿsystemenwieGoogleMail^6 o derMicrosoftO ce 3657
eingesetzt[45,S.1 ].

EinweitererundschonaktivgenutzterAnsatzistes,LinksinSpam-E-Mailsüb er
einezentraleDatenbankzuklassi zieren.HierzuwirddieseDatenbankvoneinem
intelligentenAlgorithmusb efüllt,derdynamischanalysierenkann,obessichb eider
VerlinkungumeineMalware-o derPhishing-Seitehandelt.Eineb ekannteQuellefür

(^3) https://www.cisco.com/
(^4) https://www. reeye.com/
(^5) https://www.pro ofp oint.com/
(^6) https://mail.go ogle.com/
(^7) https://pro ducts.o ce.com/en/business/explore-o ce-365-for-business


solcheDatenisthierdieGoogleSafeBrowsing^8 Datenbank.

### 5.2 Zusammenfassung.

DieseArb eitstellteinenrepräsentativenAusgangszustandvonMailinfrastrukturen
inkleinenmitmittlerenUnternehmendar. Durchdie Analyseder Messergebnis-
sekonntensoinBezugaufdieneue Bedrohungslageneue Konzepteausgebreitet
werden. DiePro jektionderneuenAnsätzeaufdieAusgangsmessdatenstellteine
AussichtaufdiegenerelleE zienzderErkennungdar.

Diegenannten0,27%(sieheAbbildung21),dienichtvom Malware-Filtererkannt
wurden,sindtrotzihrerUnscheinbarkeiteineb eachtlicheZahl.InSummesinddies
91 Nachrichten,wovonin 83 FällenauchnichtvomSpam-Filterklassi ziertworden
sind,was 83 maleinequalitativho chwertigeBedrohungfürdieAnwenderausmacht.
Das Infektionsrisiko,das vondiesen Anhängenausgehtist,wie ermittelt,inden
ersten 24 Stundensehrho ch.

```
Abbildung21:AnteildervomMacroMiltererkanntenMalware.Quelle:Autor
​```
ImBereichderVerhinderungvonSpamkonntediesmiteinfachenundvorhande-
nen Mitteln dargestellt werden. Essindhierzu keine weiterenkomplexen Imple-
mentierungennötig.DurchdieselbständigeErweiterungderDatenbankmitallen

(^8) https://develop ers.go ogle.com/safe-browsing/


ausgehendenE-MailabsendernentstehteinselbstlernendesSystem.Somüssenkeine
sp eziellenWartungeno derandereAktualisierungenvorgenommenwerden,umeine
gleichbleib ende zienteErkennungzugewährleisten.

Auchgroÿe Internet rmen wieGoogle hab enangefangen,intelligentereFilterme-
tho denzuentwickelnundeinzusetzen[38,S.3].DiesezeitgemäÿeArt,vonzumeist
kombiniertenFiltermetho den,sollMalwareundSpamaufeineneueArterkennen
undverhindern[36,S.9].InvielenFällensindb eidieserVorgehensweisevonEr-
kennungssystemenjedo cheinegröÿereRechenkapazitätundlaufendeOptimierun-
generforderlich,wasb eieinemkleinerenUnternehmenausKosten-undKnowHow-
Gründennichtumsetzbarist.

Sowohl die Erkenntnisse aus dieser Arb eit, als auch die von S. Kumar und S.
Arumugam[25,S.878]zeigen, dassklassischenMetho den derAnalysevonSpam
o derMalwarekeineausreichendeSicherheitmehrbietenkönnen.NeueErkennungs-
metho de sind in naher Zukunft für eine weitere Sicherheitsoptimierung von E-
Mailinfrastrukturennotwendig.HierzusinddieunterschiedlichstenAnsätzedenk-
bar.InvielenFällenmussmiteinererhöhtenRechen-undDatenkapazitätfürdie
Filterunggerechnetwerden.DieseArb eitzeigt,dassauchmiteinfachemundintelli-
gentemAuswertenvonschonvorhandenInformationeneineErhöhungderGesamt-
sicherheiterreichtwerdenkann.UmdieszuerreichensindkeineGroÿrechnersystem
notwendig,sondernesreichtaus,einigeOptimierungendervorhandenInfrastruk-
turvorzunehmen. DieEntwicklung undder Einsatzdes MacroMilter zeigt diese
Möglichkeitentsprechenddeutlichauf.

### 5.3 Diskussion

Die erwähnten kommerziellen Anti-Malware-Pro dukteund Technologien sindim
Bereich des Mittelstandsundin Konzernen sicherlicheine guteErweiterung der
SicherheitsinfrastrukturvonE-Mailsystemen.Jedo chgiltesdiesenAnsatzkritisch
inBezugaufdieE zienzunddesDatenschutzeszub etrachten.WährendderEr-
stellungderArb eitwurdemitzweiführendenHerstellernvonAnti-Malware-und
Anti-Spam-Lösungendiskutiert.Imb eidenFällen,b eiderBetrachtungdesCloud-,
alsauchSandb ox-Ansatzes,istsomitdieFrageo en,obdieErkennungsgeschwindig-
keitenundErkennungsratenderMalwareundSpam-E-Mailsimpro duktivenAlltag


üb erhauptsigni kantgesteigertwerdenkönnen.

EinegrundlegendeVerb esserungderb eidenWertewirdhierb einichtinfragegestellt,
jedo chobdieVerhältnismäÿigkeitdesVorgangesinBezugaufdenMehrwertzielfüh-
rendist.Zub eachtengiltes,dassinnaherZukunftauchandereWegederVerteilung
vonMalware-Entwicklergenutztwerdenkönnten.KanälefürdieVerbreitungkönn-
tenhierMessagingPro duktewieWhatsApp^9 o derSkype^10 sein.Beideverfügenüb er
dieMöglichkeiten,Linkso derDateienzuversenden.DerzeitsindmehreredemAu-
torb ekannteKonzerndab ei,eine EvaluierungdieserneuenKommunikationswege
durchzuführen.Zielsolleshiersein,dieseindenpro duktivenGeschäftsablaufzu
integrieren.EsstelltsichdanndieFrage,wieinnerhalbdieserzeitkritischenBerei-
chedieFiltermetho dendieZustellung verhindernkönnen.EineDurchlaufzeitder
FilterungmitrundsechsMinutenproAnhangisthiernichtmehrmöglich.

EventuellistdasBlo ckierenvonAnhängen,wieGoogleesb ereitserkannthat,die
letzteMetho de, Malwarezuvermeiden.Linksjedo ch, wirdmannicht so einfach
verbietenkönnen.

O en b eleibtauch dieFrage nach dem Datenschutz b ei einerEinsendung jedes
DokumentsineineClouddesAnti-MalwareAnbieters.PraktischwirdjederAnhang
durcheine,vomBenutzernichteinsehbare,Infrastrukturgeschleust.

VerschlüsselungimE-Mailverkehr

EinefundamentaleVerb esserungdesgesamtenE-MailverkehrsdurchdasKonzept
derob jektbasierterEnde-zu-Ende-Verschlüsselungistfraglich[23,S.390 ].InBe-
zugauf SpamundMalwarewürde diesesVorgehen nur den Vorteil bieten, dass
derAbsendernichtmehraufeinfacheWeisegefälschtunddieNachrichtnurvom
Empfängergelesen werdenkann.Hierdurchkann ab er eineserverseitigeFilterin-
stanzdieseNachricht nichtmehruntersuchen, dasiediesenurimverschlüsselten
Zustandb ereitgestelltb ekommt.SokanneinMalware-VersenderseineNachrichtmit
einemggf.gestohlenenZerti katverschlüsselnundkeinerderAnti-Malware-o der
Anti-Spam-FilterkönntensieaufdieseMerkmalehinuntersuchen.Zusätzlichwird
demBenutzerdurchdieseVerschlüsselungeinescheinbareLegitimitätderNachricht
vorgetäuscht,waseineInfektiondramatischerhöhenkönnte.

(^9) https://www.whatsapp.com/
(^10) https://www.skyp e.com/en/


MitdemFokusaufMalware-undSpam-Bekämpfungsindhierb eino cheinigeÜb er-
legung zutre en, wieeineVerschlüsselunge ektiv undrichtigeingesetztwerden
kann.EinereineSignierungfürdenSchutzderIntegritätwärehierzumindestein
guterEinstiegspunkt.

### 5.4 WeiterführendeArb eit

UmeineAussage üb erdieE zienzderb eiden Ansätzezuerhalten,sindweiter-
führendeAnalysenundAuswertungennötig.DurchdiezeitlicheBegrenzungdieser
Arb eit wareine allgemeingültigeundaussagekräftigereBewertungnicht möglich.
Denno chwurdezweiAnsätzefüreineschnelleunde zienteFilterunggezeigt.

Weiterführend ist der Ansatz zur Verhinderung von Spam in einer praktischen
Anwendungzub etrachten.EinekonkreteImplementierungwärehieralsnächster
Schrittzusehen.EinenachgelagerteLangzeitanalyseisteb ensoangedacht,umdie
E zienzgenauerzub etrachten.

ImBereichderVerhinderungvonMakro-MalwarewurdeschoneinekonkreteIm-
plementierungdurchgeführt.Hierb eiwurdederMacroMilterentwickelt,dersichan
demdargestelltenAnsatzorientiert.DurchdieBetrachtungderMessergebnissedes
Filterssolldieserweiterhinoptimiertwerden.

### 5.5 Danksagung

AndieserStellemö chteichmichzunächstb eimeinenb eidenBetreuernHerrenProf.
Dr.MartinGoikundBenjaminKennerfürdasVertrauenunddieMöglichkeitfür
dieseArb eitdanken.Zusätzlichmö chteichmeinKollegePeter Schiekfürseinen
InputundGedankenstoÿfürdiesesThemadanken.

UndzuletztgiltderDankmeinerlieb enAlexsowieFreundenundFamiliefürihre
GeduldundHilfe.OhnedieseUnterstützungwäreichnicht andieserZeileange-
langt.

```
Danke!
​```

## Glossar

Base64 isteine8-BitKo dierungfürBinärdaten.

BitCoin isteineneuartigeWährungundwurde 2008 dasersteMalerwähnt.Hierb ei
handeltessichumeineselbstregulierendeWährung,dienichtvonBankenge-
steuertwird.Angeb otundNachfrageb eein ussenhierdenKurs.Durchseine
kryptographischenEigenschaften istdieZahlungsmetho debiszurUmwand-
lunginö entlichgehandeltenWährungenanonym.

Cloud steht fürdas englischeWort Wolke undwirdinder ITalsSynonym für
verteiltes RechnenvonDaten verwendet.AnbietersolcherRechnerverbände
sindz.B.MicrosftAzure^11 o derAmazonWebServices^12.

Dropp er AlsDropp erwirdeineMalwareb ezeichnetdienurdieAufgab ehat,andere
MalwarenachzuladenundaufdemSystemzuinstallieren.

False-Negativ stelltdasGegenteilvonFalse-Positivedar.EineErkennungvonMal-
wareo der Spambleibhierb eidurchdenFilter ausunddieNachricht wird
fälschlicherWeisezugestellt.

FullyQuali edDomainNameDieseBezeichnungstellteinenvollständigenName
einesSystemso derEndpunktesimNetzwerkdar.

Ham DasenglischeWortfürSchinkenwirsinnbildlichfüreinegutartigeundge-
wollteE-Mailverwendet.HamstelltdasGegenteilvonSpamdar.

(^11) https://azure.microsoft.com/en-us/
(^12) https://aws.amazon.com/


Hash EinHashisteinemathematischeEinwegfunktion.Sieerstellteineneindeu-
tigen Wertüb er eineb eliebigeMengedar.Die gleicheMenge ergibtimmer
denselb en Hash-Wert. EinRückschluss vom Hash-Wert aufdie Ursprungs-
mengeistnichtmöglich.BekannteAlgorithmensindhierMD5,SHA-1o der
SHA-256.

Junk wirdalsSynonymfürSpamverwendet.

MailDeliveryAgent DieserServer-TypistfürdieZustellungundVerwaltungder
Benutzer-Mailb oxenzuständig.

MailTransferAgent EinMailTransferAgentisteineE-Mailserver-Komp onenten,
welcherfürdenEmpfang,dürdieVerarb eitungundanschlieÿendeWeiterlei-
tungeinerE-Mailzuständigist.Häu gwerdendieseMTAsmitFilteraufga-
b envertrautundsorgenalsersteInstanzvordemeigentlichenzustellenden
E-Mailserver,füreineLastreduzierung.ErstelltkeineE-Mailsdirektanden
Benutzerzusonderüb ermitteltandenMDA,derdanndieseAufgab eüb er-
nimmt.

Milter stehtfürMail-FilterundwirdimBezugaufdenPost x verwendet.Hier-
b ei handeltessichum einevom Post x b ereitgestellteSchnittstellefürdie
AnbindungweitererMail-Filter.

Multipurp oseInternetMailExtensions DieMultipurposeInternetMailExtensi-
onsbietendieMöglichkeitKommunikationsdateninTextformabzubilden.Sie
werden innerhalbdesSMTP verwendet.DiesetextuelleDarstellungvon E-
Mailsb einhaltetAnhänge,denTextundalleweiterenMetainformationenwie
Absender,Empfänger,DatumundUhrzeitusw..

Phishing BeidieserArtvonAngri handeltessichumdiekriminelleBescha ung
vonvertraulichenInformationendurchunterschiedlichsteMetho den.Einehier-
vonistz.B.dasfälscheneinervertrauenswürdigenWebseiteumdasOpferdazu
zub ewegen,seineAnmeldedatenaufdieseranzugeb en.SokanneinAngreifer
entsprechendeInformationenabgreifen.

Port-Scan EinPort-ScanisteinVorgehen,b eidemeinAngreiferdurchProbieren
von Netzwerkp orts versucht,einenÜb erblicküb er dasSystemzu erhalten.


```
ZumeistwirdhierdurchdasSendeneinesNetzwerkpaketesversuchtheraus-
zu nden,welchemNetzwerkdienstwelcherPortzugeordnetist.
​```
Ransomware isteinAkronymausRansomundSoftware,wob eiRansomdasengli-
scheWortfürErpressungist.SomitergibtsichausRansomwareeinedeutsche
Üb ersetzungvonErpresser-Software.

RequestForComments o derRFCisteinschriftlicheDarstellungeinerDiskussi-
on üb erunterschiedlicheVorgeheninderIT.Hierausentstehenimweiteren
VerlaufunterschiedlicheStandardisierungsvorlagenfürz.B.Implementierun-
genvonInternetprotokollen.

Spam istursprünglichdieAbkürzungfürdasenglischeDosen eischSpicedHam.
Dieses wurdedurchseineOmnipräsenzim KriegalsSinnbildfürunnötiges
undüb ertrieb enhäu gesVorkommengenommen.InderInformationstechnik
wirddasWortfürunerwünschteE-Mailsverwendet,diezumeistungewollte
Werbungo derMalwarezumInhalthab en.

VisualBasicAccessisteineSp ezialisierungdesVisualBasic.Hierb eihandeltes
sich um eineProgrammiersprache, dievon Microsoftentwickelt wurde. At
der Sp ezialisierung handeltes ichumAnpassungen undErweiterungen für
MicrosoftO ceDokumente.MitdieserSprachekönnenkomplexeFunktionen
ineinDokumentintegriertwerden.


## Literatur

```
[1] Al lesüber:Spam:E-Mailsicherundbenutzbarhalten.Bd.7.Linux-Magazin
Technicalreview.München:LinuxNewMedia,2008.isbn:9783939551096.
[2] Andrea Allievi und Holger Unterbrink.   CryptoWall4: The evolution con-
tinues . In: (2016). url: http : / / blog. talosintel. com / 2015 / 12 /
cryptowall- 4.html.
[3] IonAndroutsop oulos, John Koutsias,Konstantinos V. Chandrinos, George
PaliourasundConstantineD.Spyrop oulos.AnEvaluationofNaiveBayesian
Anti-SpamFiltering.2000.
[4] IonAndroutsop oulos,JohnKoutsias,KonstantinosV.ChandrinosundCon-
stantineD.Spyrop oulos.AnExperimentalComparisonofNaiveBayesianand
Keyword-BasedAnti-SpamFilteringwithPersonalE-mailMessages:Procee-
dingsofthe23rdAnnualInternationalACMSIGIRConferenceonResearch
andDevelopmentinInformationRetrieval.NewYork,N.Y.:Asso ciationfor
ComputingMachinery,2000.isbn:9781581132267.
[5] Ulrich Bayer, Paolo Milani Comparetti, Clemens Hlauschek, Christopher
KruegelundEnginKirda.Scalable,Behavior-BasedMalwareClustering.
[6] BayerischePolizei,Hrsg.Erpressungs-TrojaneraufServereinerStadtverwal-
tung   Kripo ermittelt. 2016. url: https : / / www. polizei. bayern. de /
unterfranken/news/presse/aktuell/index.html/237562.
[7] EnricoBlanzieriundAntonBryl.  Asurveyof learning-basedtechniquesof
emailspam ltering .In:Arti cialIntel ligenceReview 29.1(2008),S.63 92.
issn:0269-2821.doi:10.1007/s10462- 009- 9109- 6.url:http://eprints.
biblio.unitn.it/1070/1/056.pdf.
​```

[8] AndrewBrandt.AnatomyofaWordDocumentMacroMalwareAttack.Hrsg.
von Blue Coat Systems Inc. 2016. url: https : / / www. bluecoat. com /
security - blog / 2015 - 05 - 12 / anatomy - word - document - macro - malware -
attack.
[9] BundesamtfürSicherheitinderInformationstechnik.Ransomware -Bedro-
hungslage, Prävention&Reaktion.Deutschland,2016.url: https : / / www.
bsi.bund.de/SharedDocs/Downloads/DE/BSI/Cyber- Sicherheit/Themen/
Ransomware.pdf?__blob=publicationFile&v=2.
[10] XavierCarrerasundLluìsMàrquez.BoostingTreesforAnti-SpamEmailFil-
tering.Barcelona,2001.
[11] ChiouPin-Ren,LinPo-ChingundLiChun-Ta.  Blo ckingSpamSessionswith
Greylisting and Blo ckListing basedon Client Behavior .In: (2012).url:
http : / / citeseerx. ist. psu. edu / viewdoc / download? doi = 10. 1. 1. 401.
3018&rep=rep1&type=pdf.
[12] ZakirDurumeric,J.Alex Halderman, DavidAdrian, ArianaMirian, James
Kasten,ElieBursztein,NicolasLidzb orski,KurtThomas,VijayErantiund
MichaelBailey.  NeitherSnowNorRainNorMITM .In:the 2015 ACMCon-
ference.Hrsg.vonKenjiroCho,KensukeFukuda,VivekPaiundNeilSpring,
S.27 39.doi:10.1145/2815675.2815695.
[13] Ronald Eikenb erg. Neue Masche: Krypto-Trojaner Locky über Javascript-
Dateien verbreitet. Hrsg. von HeiseMedien GmbH & Co.KG. 2016.url:
[http://heise.de/-](http://heise.de/-) 3113689.
[14] Ronald Eikenb erg und Schmidt Jürgen.   To janer auf Raubzug:
Verschlüsselungs-Malwareanalysiert .In:c'tmagazinfürcomputertechnik 7
(2016),S.86 87.
[15] MarkusEngelb erth.  So cialMalco de:BenutzerabhängigeSchadprogramme .
Dissertation. Mannheim:Universität Mannheim, 2013.url: http : / / ub -
madoc.bib.uni- mannheim.de/34511/1/promotionsarbeit.pdf.
[16] Federal Bureauof Investigation, Hrsg.Criminals Continueto Defraud and
Extort Funds from Victims Using CryptoWal l Ransomware Schemes. 2015.
url:https://www.ic3.gov/media/2015/150623.aspx.
[17] ThomasFox-Brewster.AsRansomware CrisisExplodes,Hol lywood Hospital
CoughsUp$17,000 InBitcoin.Hrsg.vonForb es.2016.url:http : / / www.
forbes.com/sites/thomasbrewster/2016/02/18/ransomware- hollywood-
payment- locky- menace.


[18] AlexandreGazet.  Comparativeanalysisofvariousransomwarevirii .In:Jour-
nalinComputerVirology6.1(2010),S.77 90.issn:1772-9890.doi:10.1007/
s11416- 008- 0092- 2.
[19] PaulGraham.APlanforSpam.2002.url:http : / / www. paulgraham. com /
spam.html.
[20] K. Harrenstien,M. StahlundE. Feinler.RFC 952. 1985.url:https : / /
tools.ietf.org/html/rfc952.
[21] HansIrlacher.AdvancedThreatProtection.31.03.2016.
[22] AxelKannenb erg.Ransomware:US-Krankenhauszahlt 40 BitcoinsLösegeld.
Hrsg.vonHeiseMedienGmbH&Co.KG.2016.url:http : / / heise. de/ -
3109956.
[23] WalterKrihaundRolandSchmitz.SichereSysteme:Konzepte,Architekturen
undFrameworks. Xp ert.press.Berlin: Springer,2009.isbn:9783540789581.
doi:10.1007/978- 3- 540- 78959- 8.
[24] MurrayS.KucherawyundDaveCro cker.RFC 6647:EmailGreylisting:An
ApplicabilityStatementfor SMTP.2012.url:https : / / tools. ietf. org /
html/rfc6647.html.
[25] S.KumarundS.Arumugam.  AProbabilisticNeuralNetworkBasedClassi -
cationofSpamMailsUsingParticleSwarmOptimizationFeatureSelection .
In:Midd le-East JournalofScienti cResearch 23 (2015),S.874 879.url:
[http://idosi.org/mejsr/mejsr23%285%2915/17.pdf.](http://idosi.org/mejsr/mejsr23%285%2915/17.pdf.)
[26] Philipp eLagadec.8KBofmalwarecrammedintoasinglecommandlineina
macro.2016.url:http://www.decalage.info/en/8KB_oneliner.
[27] WilliamLargent.Ransomware: Past,Present, andFuture. Hrsg.von Cisco
Systems.2016.url:http : / / blog. talosintel. com / 2016 / 04 / ransomware.
html.
[28] GunnarLindb erg.Anti-SpamRecommendationsforSMTPMTAs.Hrsg.von
IETF.1999.url:https://tools.ietf.org/html/rfc2505.
[29] MicrosoftMalwareProtection Center,Hrsg.Newfeature inO ce 2016 can
blockmacrosandhelppreventinfection.2016.url:https://blogs.technet.
microsoft. com / mmpc / 2016 / 03 / 22 / new - feature - in - office - 2016 - can -
block- macros- and- help- prevent- infection/?platform=hootsuite.
[30] Microsoft,Hrsg.MalwareProtectionCenter:Macromalware:Summary.2015.
url: http : / / download. microsoft. com / download / A / E / 5 / AE546268 -


519C- 4A7E- 8EC4- 9EE29A80B79D/MMPC%20Threat%20Intelligence%20July%
202015.pdf.
[31] FabioPagani,MatteoDeAstis,MarianoGraziano,AndreaLanziundDavide
Balzarotti.MeasuringtheRoleofGreylistingandNolistinginFightingSpam.
[32] Rob ertoPaleari.  Dealingwithnext-generationmalware .Dissertation.Mai-
land:UniversitätMailand,2011.
[33] Norb ert Pohlmann.   Bedrohungen und Herausforderungen des E-Mail-
Dienstes:DieSicherheitsrisikendesE-Mail-DienstesimInternet .In:Daten-
schutzundDatensicherheit-DuD 34.9(2010),S.607 613.issn:1614-0702.
doi:10.1007/s11623- 010- 0145- 9.
[34] Pro ofp oint, Hrsg. HumanFactor Report 2016. 2016. url: https : / / www.
proofpoint.com/us/human- factor- report- 2016.
[35] NielsProvos,Dean McNamee,PanayiotisMavrommatis,KeWang undNa-
gendraMo dadugu.TheGhostInTheBrowser:AnalysisofWeb-basedMal-
ware.Hrsg.vonGo ogleInc.doi: 10. 1787 / 578054332028.url:https : / /
www. usenix. org / legacy / events / hotbots07 / tech / full _ papers / provos /
provos.pdf.
[36] MoheebAbuRa jab,LucasBallard,NoèLutz,PanayiotisMavrommatisund
NielsProvos.CAMP:Content-AgnosticMalwareProtection.Hrsg.vonGo ogle
Inc.
[37] PeterW.Resnick.InternetMessageFormat:RFC 2822 .2001.url:https :
//www.ietf.org/rfc/rfc2822.txt.
[38] KonradRieck,PhilippTrinius,CarstenWillemsundThorstenHolz.  Auto-
maticAnalysisofMalwareBehaviorusingMachineLearning .In:IOSPress
(2011).
[39] S. Ritterbusch.Die Mathematik des Bayes Spam lters.Hrsg. von Karlsru-
her Institut fürTechnologie. url: http : / / www. math. kit. edu / ianm4 /
~ritterbusch/seite/spam/de.
[40] HenryStern,JustinMasonundShepherdMichael.ALinguistics-BasedAttack
onPersonalisedStatisticalE-mailClassi ers:TechnicalReport CS-2004-06.
2004.url:https : / / www. cs. dal. ca / sites / default / files / technical _
reports/CS- 2004- 06.pdf.
[41] Symantec Corp oration, Hrsg. Security Response Publications. 2016. url:
https : / / www. symantec. com / security _ response / publications /
monthlythreatreport.jsp#Spam.

[42] TheApacheSoftwareFoundation,Hrsg.TheApacheSpamAssassinProject:
TestsPerformed:v3.2.x.2014.url:https : / / spamassassin. apache. org /
tests_3_2_x.html.
[43] TheRadicatiGroupInc.,Hrsg.EmailStatisticsReport2015-2019.2015.url:
http : / / www. radicati. com / wp / wp - content / uploads / 2015 / 02 / Email -
Statistics- Report- 2015- 2019- Executive- Summary.pdf.
[44] JörgThoma."Antivirensoftwareisttot".Hrsg.vongolem.de.2014.url:http:
/ / www. golem. de / news / symantec - antivirensoftware - ist - tot - 1405 -
106251.html.
[45] KurtThomas,ChrisGrier,JustinMa,VernPaxsonundDawnSong. design
andEvaluationofaReal-TimeURLSpamFilteringService .In: 2011 IEEE
Symposium onSecurity andPrivacy(SP), S.447 462.doi: 10. 1109 / SP.
2011.25.
[46] IvoTruxa. TheAuto-WhiteList.2014.url: https : / / wiki. apache. org /
spamassassin/AutoWhitelist.
[47] GregoryM.Vaudreuil.EnhancedMailSystemStatusCodes:RFC 3463 .2003.
url:https://tools.ietf.org/html/rfc3463.
[48] MichaelVeit.SofortmaÿnahmengegenKrypto-Trojaner:EinSophosWhitepa-
per. Hrsg. von SophosLtd. 2016.url: https : / / www. sophos. com / de -
de / medialibrary / Gated % 20Assets / white % 20papers / Sophos - emergency -
measures- against- crypto- Trojan- wp.pdf.
[49] Verizon, Hrsg.Data Breach Investigations Report 2016. 2016. url: http :
//www.verizonenterprise.com/verizon- insights- lab/dbir/2016/.
[50] Verizon,Hrsg.Data BreachInvestigations Rreport 2015. 2015.url:http :
/ / www. verizonenterprise. com / resources / reports / rp _ data - breach -
investigation- report_2015_en_xg.pdf.
[51] Wikip edia,Hrsg.NaiveBayesspam ltering.url:https : / / en. wikipedia.
org/wiki/Naive_Bayes_spam_filtering.
[52] Wikip edia, Hrsg. Phishing. url: https : / / de. wikipedia. org / wiki /
Phishing.
[53] p ost x.org, Hrsg. Post xbefore-queue Milter support. url: http : / / www.
postfix.org/MILTER_README.html.